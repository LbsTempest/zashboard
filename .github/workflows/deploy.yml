# 工作流名称
name: Build and Deploy to GitHub Pages

# 触发器
on:
  # 触发方式一：在推送到 main 分支时自动运行
  push:
    branches:
      - main
      
  # 触发方式二：允许在 Actions 页面手动触发此工作流
  workflow_dispatch:

# 权限设置：允许工作流向你的仓库写入内容（用于推送 gh-pages 分支）
permissions:
  contents: write

# 任务定义
jobs:
  # 单个任务，负责构建和部署
  build-and-deploy:
    # 运行环境
    runs-on: ubuntu-latest
    
    # 任务步骤
    steps:
      # 步骤1: 检出（下载）你的仓库代码
      - name: Checkout 🛎️
        uses: actions/checkout@v4

      # 步骤2: 设置 Node.js 和 pnpm 环境
      - name: Set up Node.js and pnpm 🔧
        uses: actions/setup-node@v4
        with:
          node-version: '20' # 指定一个明确的 Node.js 版本
      - uses: pnpm/action-setup@v4

      # 步骤3: 安装依赖并构建项目
      - name: Install and Build 🏗️
        run: |
          pnpm i
          pnpm run build
      
      # 步骤4: 部署到 GitHub Pages
      - name: Deploy 🚀
        uses: peaceiris/actions-gh-pages@v4
        with:
          # 使用 GitHub 自动提供的令牌，无需创建个人访问令牌（PAT）
          github_token: ${{ secrets.GITHUB_TOKEN }}
          # 要部署的文件夹
          publish_dir: ./dist
